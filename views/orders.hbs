<!-- ä¸»è¦å…§å®¹ -->
<div class="mt-5">

  <div class="card border-0 px-2">

    <!-- <div class="container py-4"> -->
    <!-- 1. æ¨™é¡Œ & æœå°‹ + æŒ‰éˆ• -->
    <div class="card-header bg-white bg-transparent d-flex">
      <div class="input-group me-2">
        <span class="input-group-text border-0 bg-transparent">
          <i class="bi bi-search"></i>
        </span>
        <input type="search" class="form-control shadow-none">
      </div>


      <div class="btn-sm bg-dark rounded">
        <button type="button" class="btn btn-dark text-nowrap" disabled>+ æ–°å¢è¨‚å–®</button>
      </div>
    </div>

    <!-- 2. ç¯©é¸å€ -->
    <div class="d-flex flex-wrap gap-2 mb-4 mt-2">
      <!-- è¨‚å–®ç‹€æ…‹ -->
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterOrderStatus"
          data-bs-toggle="dropdown" aria-expanded="false">
          æ‰€æœ‰è¨‚å–®ç‹€æ…‹
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterOrderStatus">
          <li><a class="dropdown-item" href="#">è¨‚å–®æˆç«‹</a></li>
          <li><a class="dropdown-item" href="#">å¾…å‡ºè²¨</a></li>
          <li><a class="dropdown-item" href="#">å·²ç”³è«‹é€€è²¨</a></li>
          <li><a class="dropdown-item" href="#">å·²åŒæ„é€€è²¨</a></li>
          <li><a class="dropdown-item" href="#">å·²å‡ºè²¨</a></li>
        </ul>
      </div>
      <!-- ä»˜æ¬¾ç‹€æ…‹ -->
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterPaymentStatus"
          data-bs-toggle="dropdown" aria-expanded="false">
          æ‰€æœ‰ä»˜æ¬¾ç‹€æ…‹
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterPaymentStatus">
          <li><a class="dropdown-item" href="#">å·²ä»˜æ¬¾</a></li>
          <li><a class="dropdown-item" href="#">å·²é€€æ¬¾</a></li>
          <li><a class="dropdown-item" href="#">å·²å–æ¶ˆæˆæ¬Š</a></li>
        </ul>
      </div>
      <!-- é‹é€ç‹€æ…‹ -->
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterDeliveryStatus"
          data-bs-toggle="dropdown" aria-expanded="false">
          æ‰€æœ‰é‹é€ç‹€æ…‹
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterDeliveryStatus">
          <li><a class="dropdown-item" href="#">å°šæœªæ”¶è²¨</a></li>
          <li><a class="dropdown-item" href="#">è™•ç†ä¸­</a></li>
          <li><a class="dropdown-item" href="#">é‹é€ä¸­</a></li>
          <li><a class="dropdown-item" href="#">å·²åˆ°è²¨</a></li>
          <li><a class="dropdown-item" href="#">å·²é€€è²¨</a></li>
        </ul>
      </div>
      <!-- é¸æ“‡æ—¥æœŸ -->
      <div>
        <input type="date" class="form-control" placeholder="é¸æ“‡æ—¥æœŸ" aria-label="é¸æ“‡æ—¥æœŸ" />
      </div>
      <!-- é‡‘é¡ç¯©é¸ -->
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterAmount"
          data-bs-toggle="dropdown" aria-expanded="false">
          æ‰€æœ‰é‡‘é¡
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterAmount">
          <li><a class="dropdown-item" href="#">$0 - $10</a></li>
          <li><a class="dropdown-item" href="#">$10 - $20</a></li>
          <li><a class="dropdown-item" href="#">$20 ä»¥ä¸Š</a></li>
        </ul>
      </div>
    </div>

    <!-- 3. è³‡æ–™è¡¨ -->
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col"><input type="checkbox" /></th>
            <th scope="col">è¨‚å–®ç·¨è™Ÿ</th>
            <th scope="col">å®¢æˆ¶</th>
            <th scope="col">æ—¥æœŸ</th>
            <th scope="col">è¨‚å–®ç‹€æ…‹</th>
            <th scope="col">ä»˜æ¬¾ç‹€æ…‹</th>
            <th scope="col">é‹é€ç‹€æ…‹</th>
            <th scope="col">é‡‘é¡</th>
            <th scope="col">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <!-- å¾Œç«¯å–å¾—è³‡æ–™æ¸²æŸ“è¨‚å–®åˆ—è¡¨ -->
        </tbody>

      </table>
    </div>

    <!-- 4. è³‡æ–™ç­†æ•¸ & åˆ†é  -->
    <nav class="mt-2" aria-label="Page navigation example">
      <ul class="pagination justify-content-center pagination-white">
        <!-- é€™è£¡çš„ <li> æœƒç”± JS å‹•æ…‹ç”Ÿæˆ -->
      </ul>
    </nav>

    <!-- ä¸²æ¥ API -->
    <!-- API åŠŸèƒ½ï¼šå–å¾—æ‰€æœ‰è¨‚å–®çš„åˆ—è¡¨ (å¯é¸æ—¥æœŸç¯„åœåƒæ•¸) -->
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const tbody = document.querySelector("tbody");
        const paginationContainer = document.querySelector(".pagination");

        const API_BASE_URL = window.API_BASE_URL || "http://localhost:3000/api/admin";
        const token = localStorage.getItem("adminToken");

        // å°è£å‘¼å« API çš„å‡½å¼
        async function fetchOrders(params = {}) {
          const url = new URL(`${API_BASE_URL}/admin/orders`);
          Object.entries(params).forEach(([key, value]) => {
            if (value) url.searchParams.append(key, value);
          });
          console.log("ğŸš€ request URL: ", url.toString());

          const res = await fetch(url.toString(), {
            headers: {
              Authorization: `Bearer ${token}`
            }
          });
          const result = await res.json();
          if (!result.status) return;

          renderOrders(result.data.orders);
          renderPagination(result.data.pagination);
        }

        // æ¸²æŸ“è¨‚å–®è³‡æ–™
        function renderOrders(orders) {
          console.log("ğŸ‘€ æ­£åœ¨æ¸²æŸ“çš„ orders[0]ï¼š", orders[0]);
          tbody.innerHTML = "";
          orders.forEach(order => {
            console.log({ order });
            const tr = document.createElement("tr");
            tr.innerHTML = `
            <td><input type="checkbox" /></td>            
            <td class="text-start">
              <a href="/ordersDetail?orderNumber=${order.orderNumber}">#${order.orderNumber}</a>
            </td>                 
            <td class="text-start">${order.userName}</td>
            <td>${order.createdAt.split("T")[0]}</td>
            <td><span class="badge ${getBadgeClass(order.orderStatus)}">${getLabel(order.orderStatus)}</span></td>
            <td><span class="badge ${getBadgeClass(order.paymentStatus)}">${getLabel(order.paymentStatus)}</span></td>
            <td><span class="badge ${getBadgeClass(order.shippingStatus)}">${getLabel(order.shippingStatus)}</span></td>
            <td>$${order.finalAmount.toFixed(0)}</td>
            <td>
              <div class="dropdown">
                <button class="btn btn-link text-dark p-0" data-bs-toggle="dropdown">
                  <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="/ordersEdit?orderNumber=${order.orderNumber}"><i class="bi bi-pencil me-2"></i>ç·¨è¼¯</a></li>
                  <li><hr class="dropdown-divider" /></li>
                  <li><a class="dropdown-item text-danger" href="#" onclick="return confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')"><i class="bi bi-trash me-2"></i>åˆªé™¤</a></li>
                </ul>
              </div>
            </td>
          `;
            tbody.appendChild(tr);
          });
        }

        // åˆ†é æ¸²æŸ“
        function renderPagination(pagination) {
          const { page, totalPages } = pagination;
          let html = "";

          html += `<li class="page-item ${page === 1 ? 'disabled' : ''}"><a class="page-link" href="#" data-page="${page - 1}">&laquo;</a></li>`;

          for (let i = 1; i <= totalPages; i++) {
            html += `<li class="page-item ${i === page ? 'active' : ''}"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
          }

          html += `<li class="page-item ${page === totalPages ? 'disabled' : ''}"><a class="page-link" href="#" data-page="${page + 1}">&raquo;</a></li>`;

          paginationContainer.innerHTML = html;

          // ç¶å®šäº‹ä»¶
          paginationContainer.querySelectorAll(".page-link").forEach(link => {
            link.addEventListener("click", e => {
              e.preventDefault();
              const targetPage = Number(e.target.dataset.page);
              if (!isNaN(targetPage)) {
                fetchOrders({ page: targetPage });
              }
            });
          });
        }

        // ç‹€æ…‹å°æ‡‰ä¸­æ–‡ & æ¨£å¼
        function getLabel(key) {
          const map = {
            // è¨‚å–®ç‹€æ…‹
            pending: "å¾…å‡ºè²¨",
            shipped: "å·²å‡ºè²¨",
            completed: "å·²å®Œæˆ",
            cancelled: "å·²å–æ¶ˆ",
            returnRequested: "å·²ç”³è«‹é€€è²¨",
            returnAccepted: "å·²åŒæ„é€€è²¨",
            returnRejected: "å·²æ‹’çµ•é€€è²¨",

            // ä»˜æ¬¾ç‹€æ…‹
            // unpaid: "æœªä»˜æ¬¾", // ä¸éœ€è¦ï¼Œå› ç‚ºåªæœ‰ä»˜æ¬¾æˆåŠŸæ‰æœƒæœ‰æ­£å¼è¨‚å–®
            paid: "å·²ä»˜æ¬¾",
            refunded: "å·²é€€æ¬¾",
            authorizationVoided: "å·²å–æ¶ˆæˆæ¬Š",

            // é‹é€ç‹€æ…‹
            notReceived: "å°šæœªæ”¶è²¨",
            processing: "è™•ç†ä¸­",
            inTransit: "é‹é€ä¸­",
            delivered: "å·²åˆ°è²¨",
            returned: "å·²é€€è²¨",
          };
          return map[key] || key;
        }

        function getBadgeClass(key) {
          const colorMap = {
            // è¨‚å–®ç‹€æ…‹
            "è¨‚å–®æˆç«‹": "bg-info text-dark",
            "å¾…å‡ºè²¨": "bg-warning text-dark",
            "å·²å‡ºè²¨": "bg-primary text-white",
            "å·²å®Œæˆ": "bg-success text-white",
            "å·²å–æ¶ˆ": "bg-secondary text-white",
            "é€€è²¨ç”³è«‹": "bg-warning text-dark",
            "é€€è²¨æ¥å—": "bg-primary text-white",
            "é€€è²¨é§å›": "bg-danger text-white",

            // ä»˜æ¬¾ç‹€æ…‹
            // "æœªä»˜æ¬¾": "bg-danger text-white",
            "å·²ä»˜æ¬¾": "bg-success text-white",
            "å·²é€€æ¬¾": "bg-secondary text-white",
            "ä»˜æ¬¾ä½œå»¢": "bg-secondary text-white",

            // é‹é€ç‹€æ…‹
            "å°šæœªæ”¶è²¨": "bg-secondary text-white",
            "è™•ç†ä¸­": "bg-info text-dark",
            "é‹é€ä¸­": "bg-primary text-white",
            "å·²åˆ°è²¨": "bg-success text-white",
            "å·²é€€è²¨": "bg-danger text-white",
          };
          return colorMap[key] || "bg-dark";
        }

        // é é¢åˆå§‹åŠ è¼‰
        fetchOrders({ page: 1 });
      });
    </script>