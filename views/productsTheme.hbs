<!-- ä¸»è¦å…§å®¹ -->
<div class="mt-5">
  <div class="card border-0">
    <div class="card-header bg-white bg-transparent d-flex">
      <div class="input-group me-2">
        <span class="input-group-text border-0 bg-transparent">
          <i class="bi bi-search"></i>
        </span>
        <input type="search" class="form-control shadow-none" placeholder="æœå°‹åˆ†é¡åç¨±">
      </div>


      <div class="btn-sm bg-dark rounded">
        <a href="/productsTheme-create" class="btn btn-dark text-nowrap">+ æ–°å¢åˆ†é¡</a>
      </div>
    </div>

    <!-- card-header -->
    <div class="card-body">
      <table class="table table-hover align-middle w-75 mx-auto text-center">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">åˆ†é¡åç¨±</th>
            <th scope="col">æ›¸ç±æ•¸é‡</th>
            <th scope="col">æ“ä½œ</th>
          </tr>
        </thead>

        <tbody>

        </tbody>

      </table>
      <!-- æ”¾åœ¨ table ä¹‹å¾Œï¼Œbody åº•éƒ¨ä¹Ÿå¯ä»¥ -->
      <!-- æ“ä½œ Modal -->
      <!-- åˆªé™¤ç¢ºèª Modal -->
      <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel"
        aria-hidden="true">
        <div class="modal-dialog mt-2">
          <div class="modal-content border-0 shadow">
            <div class="modal-header">
              <h5 class="modal-title fw-bold" id="deleteConfirmModalLabel">è­¦å‘Šï¼</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
            </div>
            <div class="modal-body">
              æ­¤å‹•ä½œç„¡æ³•é‚„åŸï¼æ˜¯å¦ç¢ºå®šè¦åˆªé™¤ï¼Ÿ
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å¦</button>
              <button type="button" class="btn btn-danger" id="confirmDeleteBtn">æ˜¯</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<nav class="mt-2" aria-label="Page navigation example">
  <ul class="pagination justify-content-center pagination-white">
    <li class="page-item">
      <a class="page-link" href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>

    <li class="page-item active">
      <a class="page-link" href="#">1</a>
    </li>

    <li class="page-item">
      <a class="page-link" href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>

<!-- æ“ä½œ ... -->

<!-- å°šæœªé–‹ç™¼ -->
<!-- checkbox é¸å–å…¨éƒ¨åŠŸèƒ½ -->

<!-- ä¸²æ¥ API -->
<!-- å–å¾— å–å¾—åˆ†é¡åˆ—è¡¨ -->
<script>
  const isDev = window.location.hostname === "localhost";
  const API_BASE_URL = isDev
    ? "http://localhost:8081/api"
    : "/api";


  document.addEventListener("DOMContentLoaded", async () => {
    console.log(localStorage);
    const token = localStorage.getItem("adminToken");

    try {
      const res = await fetch(`${API_BASE_URL}/admin/categories?page=1&limit=10`, {
        headers: {
          Authorization: `Bearer ${token}`,
          Accept: "application/json",
        },
      });
      console.log(res);

      const result = await res.json();
      if (!result.status) {
        return alert("å–å¾—åˆ†é¡è³‡æ–™å¤±æ•—ï¼š" + result.message);
      }

      const categories = result.data.categories;
      const tbody = document.querySelector("tbody");

      console.log(`è³‡æ–™åœ¨é€™è£¡ï¼š`);
      categories.forEach((d) => {
        console.log(d);
      });

      // æ¸…ç©ºç¾æœ‰å…§å®¹
      tbody.innerHTML = "";

      // å°‡è³‡æ–™å¡å…¥è¡¨æ ¼
      categories.forEach((cat) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
        <td>${cat.id}</td>
        <td>${cat.name}</td>
        <td>${cat.booksCount}</td>
        <td>
      <div class="dropdown">
        <button class="btn btn-link text-dark p-0" type="button" id="dropdown-${cat.id}" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-three-dots fs-6"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdown-${cat.id}">
          <li>
            <a class="dropdown-item" href="/productsTheme-edit/${cat.id}">ç·¨è¼¯</a>
          </li>
          <li>
            <a class="dropdown-item text-danger" href="#" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal" data-id="${cat.id}">åˆªé™¤</a>
          </li>
        </ul>
      </div>
    </td>
      `;

        tbody.appendChild(tr);
      });

    } catch (err) {
      console.error("ğŸš¨ éŒ¯èª¤ï¼š", err);
      alert("ç„¡æ³•å–å¾—åˆ†é¡è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦");
    }
  });
</script>


<!-- DELETE(æ“ä½œé¸å–®) -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tbody = document.querySelector("tbody");
    const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
    const deleteConfirmModal = new bootstrap.Modal(document.getElementById("deleteConfirmModal"));

    let deleteTargetId = null;
    let deleteTargetRow = null;

    // ç›£è½ tbody å…§æ‰€æœ‰ã€Œåˆªé™¤ã€é€£çµçš„é»æ“Šäº‹ä»¶
    tbody.addEventListener("click", function (e) {
      const target = e.target;

      if (target.matches(".dropdown-item.text-danger")) {
        e.preventDefault();
        deleteTargetId = target.dataset.id;
        deleteTargetRow = target.closest("tr");

        // é¡¯ç¤ºåˆªé™¤ç¢ºèª Modalï¼ˆé€™æ®µä½ ä¹Ÿå¯ä»¥åªç”¨ data-bs-toggle è™•ç†ï¼‰
        deleteConfirmModal.show();
      }
    });

    // ç¢ºèªåˆªé™¤æŒ‰éˆ•é»æ“Šå¾ŒåŸ·è¡Œåˆªé™¤
    confirmDeleteBtn.addEventListener("click", async () => {
      if (!deleteTargetId || !deleteTargetRow) return;

      const token = localStorage.getItem("adminToken");

      try {
        const res = await fetch(`${API_BASE_URL}/admin/categories/${deleteTargetId}`, {
          method: "DELETE",
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: "application/json",
          },
        });

        const result = await res.json();

        if (result.status) {
          alert("åˆªé™¤æˆåŠŸ");

          // å¾ DOM ä¸­ç§»é™¤
          deleteTargetRow.remove();

          // é—œé–‰ Modal
          deleteConfirmModal.hide();
        } else {
          alert("åˆªé™¤å¤±æ•—ï¼š" + result.message);
        }

      } catch (error) {
        console.error("ğŸš¨ åˆªé™¤å¤±æ•—ï¼š", error);
        alert("ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
      }
    });
  })

</script>